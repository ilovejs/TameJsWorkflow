<!doctype html>
<html>
<head>
<!--
If you have python, run "python -m SimpleHTTPServer" 
then access "http://localhost:8000/using-q.html" with your browser.
-->
<script src="//cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>
<script>
var loadText = function (url) {
    var deferred = Q.defer();
    var req = new XMLHttpRequest();
    req.onreadystatechange = function () {
        if (req.readyState !== 4) return;
        if (/^[^2]\d\d$/.exec(req.status)) return deferred.reject(req.status);
        deferred.resolve(req.responseText);
    };
    req.open("GET", url, true);
    req.send();
    return deferred.promise;
};

window.addEventListener("load", function (event) {
    var loadButton = document.getElementById("load");
    var urlInput = document.getElementById("url");
    var resultArea = document.getElementById("result");

    loadButton.addEventListener("click", function (event) {
        loadText(urlInput.value).then(function (text) {
            resultArea.textContent = text;
            // google-code-prettify
            resultArea.innerHTML = prettyPrintOne(resultArea.innerHTML);
        }).fail(alert);
    }, false);
}, false);
</script>
<script 
  src="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js"
></script>
<link rel="stylesheet" 
  href="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css"
/>
</head>
<body>
<input id="url" type="search" value="using-q.html" list="files" />
<button id="load" type="button">load</button>
<pre id="result" class="prettyprint"></pre>

<!-- the option list generated by the emacs elisp:
(progn
  (search-forward (concat "<!-" "-BEGIN-" "->"))
  (setq begin-point (point))
  (search-forward "</datalist>")
  (delete-region begin-point (point))
  (insert 
     "\n"
     (mapconcat
       (lambda (name) (concat "<option value='" name "' />"))
       (butlast (split-string (shell-command-to-string "ls") "\n"))
       "\n")
     "\n</datalist>"))  ;<= run by C-x C-e
-->
<datalist id="files"><!--BEGIN-->
<option value='chain-branch.js' />
<option value='chain-by-promise.js' />
<option value='chain-by-value.js' />
<option value='chain-concurrent-join.js' />
<option value='chain-concurrent.js' />
<option value='chain-loop.js' />
<option value='chain-nested-callback.js' />
<option value='chain-nested-promise.js' />
<option value='chain-to-action-flatten.js' />
<option value='chain-to-action-simplify.js' />
<option value='chain-to-action.js' />
<option value='chain-with-error-recover.js' />
<option value='chain-with-error.js' />
<option value='node-direct-api.js' />
<option value='node-napply.js' />
<option value='node-nbind.js' />
<option value='node-ncall.js' />
<option value='node-ninvoke.js' />
<option value='node-npost.js' />
<option value='object-apply.js' />
<option value='object-bind.js' />
<option value='object-call.js' />
<option value='object-decomposed.js' />
<option value='object-del.js' />
<option value='object-fapply.js' />
<option value='object-fbind.js' />
<option value='object-fcall.js' />
<option value='object-get.js' />
<option value='object-invoke.js' />
<option value='object-keys.js' />
<option value='object-post.js' />
<option value='object-primitive.js' />
<option value='object-put.js' />
<option value='object-unused.js' />
<option value='promise-delay.js' />
<option value='promise-end-flow.js' />
<option value='promise-failure-action.js' />
<option value='promise-fin-flow.js' />
<option value='promise-fin-flow2.js' />
<option value='promise-multiple-resolve-spread-flow.js' />
<option value='promise-reject-fail-flow.js' />
<option value='promise-reject-then-flow.js' />
<option value='promise-reject.js' />
<option value='promise-resolve-then-flow.js' />
<option value='promise-resolve.js' />
<option value='promise-return-reject-flow.js' />
<option value='promise-throw-fail-flow.js' />
<option value='promise-throw-uncaught-flow.js' />
<option value='promise-timeout.js' />
<option value='promise-translate-action.js' />
<option value='promise-when.js' />
<option value='shell.html' />
<option value='using-callback.js' />
<option value='using-nested-callback.js' />
<option value='using-promise-with-error.js' />
<option value='using-promise.js' />
<option value='using-q.html' />
</datalist>
</body>
</html>
